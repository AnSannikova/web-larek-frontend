# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


## **Архитектура**

В проекте использован шаблон проектирования MVP (Model-View-Presenter). Коммуникация между классами происходит через события.


![UML.png](./UML.png)

### Базовый код

- **Класс `EventEmitter`**
    
    В проекте представляет собой тип Presenter. Это брокер событий. Его функции: возможность установить и снять слушателей событий, вызвать слушателей при возникновении события.
    
    Методы:
    
    `on` — для подписки на событие;
    
    `off` — для подписки на событие;
    
    `emit` — для уведомления подписчиков о наступлении события соответственно;
    
    `onAll` — для сброса всех подписчиков;
    
    `trigger` — генерирующий заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от класса EventEmitter.
    
- **Класс `Api`**
    
    Класс отправляет запросы на сервер. Имеет возможность сделать GET и POST - запросы, а также имеет метод для обработки данных в формат json в ответе от сервера или вывода ошибки при неудачном запросе
    
    Методы:
    
    `handleResponse` — для обработки ответа от сервера: либо преобразует его в формат json, либо формирует ошибку;
    
    `get` — отправляет GET - запрос;
    
    `post` — отправляет POST - запрос.
    
- **Класс `Model<T>`**
    
    Абстрактный класс служит средством для хранения данных поступающих с сервера. В проекте представляет собой тип Model. Принимает в конструктор экземпляр класса `EventEmitter`, благодаря чему реализует метод для уведомления изменения модели и передачи подписчикам измененных данных. Класс является дженериком и принимает в переменной `T` тип и состав данных, которые необходимо сохранить в модели. 
    
    Методы:
    
    `emitChanges` — сообщить об изменении данных в модели.
    
- **Класс `Component<T>`**
    
    В проекте представляет собой тип View. Абстрактный класс базового компонента представляет собой инструментарий для работы с DOM-элементом. Наследуется всеми классами представления. Класс является дженериком и принимает в переменной `T` тип и состав данных, которые необходимы для метода `render`. 
    
    Методы:
    
    `setText` — установить текстовое содержимое;
    
    `setImage` — установить изображение;
    
    `toggleClass` — переключает класс;
    
    `setDisabled` — переключить статус блокировки элемента;

    `setHidden` — скрыть элемент;
    
    `render` — принимает объект с данными и возвращает готовый DOM-элемент с этими данными.
    

### Компоненты модели:

- **Класс `AppSate`**
    
    Класс для работы с состояниями приложения. Наследуется от класса `Model`. Хранит в себе информацию о состоянии корзины, продуктах, элементах объекта заказа, осуществляет его валидацию. `IAppSateData` интерфейс состава данных, которые должны храниться в модели.
    
    Методы:
    
    `setProducts` — установить внутри класса данные о продуктах;
    
    `getProducts` — получить данные о продуктах;

    `setPreviewCard` — устанавливает данные о выбранной карточке в модель;

    `addToBasket` — добавить данные элемента в список элементов корзины;

    `removaFromBasket` — удалить данные элемента из корзины;
    
    `getBasketItems` — получить данные продуктов в корзине;
    
    `getTotal` — получить общую сумму стоимость товаров в корзине;
    
    `clearBasket` — очистить корзину;
    
    `setOrder` — установить значения полей для формирования заказа;

    `validateOrder` — валидация формы, устанавливается событие об изменении объекта, хранящего ошибки;
    
    `getOrder` — получить заполенную форму заказа.
    
    ```tsx
    class IAppSate extends Model<IAppSateData> {}
    ```
    

### Компоненты представления:

**Общие переиспользуемые блоки:**

- **Класс `Modal`**
    
    Класс реализующий вид и функционал модального окна. Наследуется от класса `Component`. `IModalData` интерфейс данных для метода `render`.
    
    Методы:
    
    `content` — устанавливает контент внутри модального окна;
    
    `open` — открывает модальное окно;
    
    `close` — закрывает модальное окно;
    
    `render` — переопределяет родительский метод, принимает объект с данными и возвращает готовый DOM-элемент с этими данными;
    
    ```tsx
    class Modal extends Component<IModalData> {}
    ```
    
- **Класс `Form<T>`**
    
    Общий класс для работы с формами. Наследуется от класса `Component`. Отвечает за установку ошибок при заполнении формы, блокировку кнопки сабмита, если форма не валидна, и отрисовку самой формы. Класс является дженериком и принимает в переменной `T` тип и состав данных, которые необходимо получить на вход для метода `render`.  
    
    Методы:

    `onInputChange` — устанавливает слушатель на изменение полей формы;
    
    `errors` — устанавливает ошибки при отсутствии заполненных полей;
    
    `valid` — отвечает за блокировку кнопки сабмита;
    
    `render` — принимает объект с данными и возвращает готовый DOM-элемент с этими данными.
    
    ```tsx
    class Form<T> extends Component<IFormState> {}
    ```
    

**Остальные компоненты:**

- **Класс** **`ApiShop`**
    
    Класс упрощает работу c сервером и приводит данные в ответе к удобному виду. Наследуется от класса `Api`. 
    
    Методы:
    
    `getItemList` — получить список продуктов и их данные;
    
    `getItem` — получить подробную информацию об одном товаре через его идентификатор;
    
    `orderProducts` — отправить заказ и получить ответ от сервера об успешной отправке в виде идентификатора заказа и общей стоимости;
    
- **Класс `Page`**
    
    Класс отвечает за отображение счетчика корзины, установку элементов галлереи и блокировку страницы при открытии модального окна. При нажатии на иконку корзины формируется соответствующее событие об открытии корзины и открывается модальное окно. Наследуется от класса `Component`.  `IPageData` интерфейс состава данных, которые передаются в родительский метод `render` для отображения на странице.
    
    Методы:
    
    `counter` — установить значение счетчика;

    `gallery` — устанавливает элементы корзины;
    
    `locked` — отвечает за блокировку прокрутки страницы, можно указать значения true или false.
    
    ```tsx
    class Page extends Component<IPageData> {}
    ```
    
- **Класс `Card`**
    
    Наследуется от класса `Component`. Отвечает за отображение карточки товара. Если в карточке предусматривается кнопка, по нажатию на нее формируется событие изменения элементов корзины, и происходит либо добавление товара в корзину, либо его удаление. Если это карточка галерии, при клике на саму карточку формируется событие выбора карточки. `ICardActions` интерфейс действия, совершаемого при клике на кнопку или карточку.
    
    Методы:
    
    `category` — установить значение категории товара;
    
    `title` — установить значение заголовка товара;
    
    `image` — установить значение картинки товара;
    
    `descripton` — установить значение описания товара;
    
    `price` — установить значение стоимости товара;

    `buttonLable` — изменение надписи на кнопке.
    
    ```tsx
    class Card extends Component<IProduct> implements ICard {}
    ```
    
- **Класс `CardBasket`**
    
    Наследуется от класса `Card`. Отвечает за отображение карточки в корзине. К реализации основного класса добавляется метод установки порядкового номера товара в корзине. 
    
    Методы:
    
    `index` — установить значение порядкового номера товара.
    
- **Класс `Basket`**
    
    Наследуется от класса `Component`. Отвечает за отображение товаров в корзине и общей суммы заказа. При клике на кнопку формируется соответствующее событие об открытии формы заказа. `IBasketData` интерфейс состава данных, которые передаются в родительский метод `render` для отображения на странице. 
    
    Методы:
    
    `items` — установить элементы корзины в свойтсво `_basketList` класса;
    
    `total` — установить значение общей суммы покупки;
    
    ```tsx
    class Basket extends Component<IBasketData> {}
    ```
    
- **Класс `Order`**
    
    Наследуется от класса **`Form<T>`.** Отвечает за отображение формы заказа. При незаполненной форме кнопка сабмита не активна. При нажатии на кнопку формируется соответствующее событие и происходит открытие формы контактов. `IOrderForm` интерфейс состава данных, которые передаются в родительский метод `render` для отображения на странице.
    
    Методы:
    
    `address` — установить значение поля адрес;
    
    `selected` — отвечает за установку класса для выбранной кнопки способа оплаты.
    
    ```tsx
    class Order extends Form<IOrderForm> {}
    ```
    
- **Класс `Contacts`**
    
    Наследуется от класса **`Form<T>`.** Отвечает за отображение формы контактов. При нажатии на кнопку сабмита формируется соответствующее событие.  `IContactsForm` интерфейс состава данных, которые передаются в родительский метод `render` для отображения на странице.
    
    Методы:
    
    `email` — установить значение поля электронной почты;
    
    `phone` — установить значение поля номера телефона;
    
    ```tsx
    class Contacts extends Form<IContactsForm> {}
    ```
    
- **Класс `Success`**
    
    Наследуется от класса `Component`. Отвечает за отображение окна об успешной отправке заказа. Отображает общую сумму заказа. При клике на кнопку закрывается модальное окно.`ISuccessData` интерфейс состава данных, которые передаются в родительский метод `render` для отображения на странице. `ISuccesssAction` интерфейс действия, совершаемого при клике кнопку.
    
    Методы:
    
    `description` — устанавливает значение общей суммы заказа.
    
    ```tsx
    class Success extends Component<ISuccessData> {} 
    ```
    

Список событий:

- `gallery:changed` — изменились элементы галереи (продукты), происходит установка новых данных в модель, и на их сновании отрисовка карточек в галерее;
- `card:select` — выбрана карточка, ее данные записаны в модель; 
- `preview:changed` — изменилось превью, на основании данных выбранной карточки происходит отрисовка карточки с подробной информацией о товаре в модальном окне;
- `basket:changed` — изменились элементы корзины, происходит получение новых данных об элементах из модели, на их основании отрисовываются новые элементы корзины;
- `basket:open` — корзина открыта;
- `modal:open` — модальное окно открыто, главная страница блокируется;
- `modal:close` — модальное окно закрыто, снимается блокировка с главной страницы;
- `order:open` — открыта форма заказа, в модальном окне отрисовывается форма заказа;
- `formErrors:change` — изменился объект, хранящий ошибки валидации, если нет ошибок кнопка сабмита формы становится активной;
- `order.mayment:change` — выбран способ оплаты, данные заносятся в модель в объект заказа;
- `order.address:change` — изменилось поле ввода адреса доставки, данные ввода заносятся в модель в объект заказа;
- `order:submit` — форма заказа готова и валидна, в модальном окне отрисовывается форма контактов;
- `contacts.email:change` — изменилось поле ввода email, данные ввода заносятся в модель в объект заказа;
- `contacts.phone:change` — изменилось поле ввода номера телефона, данные ввода заносятся в модель в объект заказа;
- `contacts:submit` — форма контактов готова и валидна, происходит отправка на сервер данных заказа. На основании ответа отрисовывается модальное окно с информацией об успешном оформлении заказа.